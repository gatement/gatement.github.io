<html>
<head>
<link rel="stylesheet" type="text/css" href="/css/site.css">
</head>
<body>
<h3>SSH Tunnel</h3>
<hr/>
<ul>
  <li>
    <strong>Dynamic Port Forwarding</strong>: listening on ssh client, forwarding from ssh server, target host:port is determined by SOCKS4/SOCKS5
    <pre>
    # -f is running in background, optinal
    # -v is printing debugging messages
    ssh -ND [bind_address:]port johnson@jserver

    # example: set up a SOCKS5 proxy at localhost
    ssh -vND 1080 johnson@jserver
    </pre>
  </li>
  <li>
    <strong>Local Port Forwarding</strong>: listening on ssh client, forwarding from ssh server
    <pre>
    # -f is running in background, optinal
    # -v is printing debugging messages
    ssh -NL [bind_address:]port:host:hostport] johnson@jserver
    </pre>
  </li>
  <li>
    <strong>Remote Port Forwarding</strong>: listening on ssh server, forwarding from ssh client
    <pre>
    # -f is running in background, optinal
    # -v is printing debugging messages
    ssh -NR [bind_address:]port:host:hostport] johnson@jserver

    # example: remote access LAN server
    # 1. on the LAN server, port 10000 will listen on remote server, 22 is the LAN server ssh port
    ssh -vNR 10000:localhost:22 remote_server_user@jserver
    # 2. one the remove server
    ssh -p10000 lan_server_user@localhost
    </pre>
  </li>
</ul>

<h3>start up as CentOS7 systemd service</h3>
<hr/>
<ol>
  <li>
    create service file
    <pre>
    # vi /usr/lib/systemd/system/myproxy.service
    [Unit]
    Description=SSH tunnel to proxy server
    Wants=network-online.target
    After=network-online.target

    [Service]
    Type=forking
    ExecStart=/usr/bin/ssh -NfD 1080 -i /root/.ssh/id_rsa johnson@jserver

    [Install]
    WantedBy=multi-user.target
    </pre>
  </li>
  <li>
    config ssh client keepalive
    <pre>
    # vi /etc/ssh/ssh_config
    Host *
        # the keepalive msg to send before disconnected
        ServerAliveCountMax 2
        # in seconds
        ServerAliveInterval 60
    </pre>
  </li>
  <li>
    enable service
    <pre>
    systemctl enable myproxy.service
    </pre>
  </li>
  <li>
    start service
    <pre>
    systemctl start myproxy.service
    </pre>
  </li>
</ol>

<h3>proxy tools</h3>
<hr/>
<ul>
  <li>
    <strong>privoxy</strong>: turn SOCKS4/SOCKS5 into HTTP proxy
    <pre>
    yum install epel-release
    yum install privoxy

    # vim /etc/privoxy/config
    forward-socks5 / 127.0.0.1:1080 .

    systemctl start privoxy.service

    # it will listen on TCP 8118
    </pre>
  </li>
  <li>
    <strong>SwitchyOmega</strong>: Google Chrome extension, good with SOCKS4/SOCKS5
  </li>
</ul>

<h3>use proxy</h3>
<hr/>
<ul>
  <li>
    <strong>yum</strong>
    <pre>
    # vim /etc/yum.conf
    proxy=http://127.0.0.1:8118
    </pre>
  </li>
  <li>
    <strong>docker</strong>: 
    <a href="https://docs.docker.com/config/daemon/systemd/#httphttps-proxy">https://docs.docker.com/config/daemon/systemd/#httphttps-proxy</a>
  </li>
</ul>

</body>
</html>
